# PRD: Health Agents Collective

**Version:** 1.0
**Date:** 2025-08-04

---

## 1. Introduction

This document outlines the Product Requirements for the **Health Agents Collective**, a system of autonomous AI agents designed to work collaboratively to automate and streamline complex processes within a hospital environment. The agents will leverage Google's A2A (Agent-to-Agent) communication protocol and the Model Context Protocol (MCP) to ensure seamless interaction, data exchange, and integration with external systems, primarily a FHIR server for patient data management.

## 2. Problem Statement

Hospital workflows, such as patient diagnosis, insurance verification, and specialist referrals, are often fragmented, time-consuming, and reliant on manual data entry. This can lead to delays in patient care, administrative inefficiencies, and potential for human error. There is a critical need for an intelligent, automated system that can orchestrate these processes, ensuring that information flows securely and efficiently between different functional units.

## 3. Goals and Objectives

- **Primary Goal:** To create a robust, scalable, and autonomous multi-agent system that automates key clinical and administrative workflows in a hospital.
- **Objectives:**
    - To significantly reduce the time and manual effort required for patient processing.
    - To improve the accuracy and timeliness of patient data management.
    - To establish a clear and auditable trail of all actions performed by the agents.
    - To build a flexible architecture that allows for the easy addition of new agents and capabilities.

## 4. Core Components & Agents

The system will be composed of a central orchestrator and several specialized agents.

### 4.1. Orchestration Agent
The central coordinator of the system. It receives initial patient information and a task, then delegates sub-tasks to the appropriate specialized agents. It is responsible for managing the overall workflow, ensuring tasks are completed in the correct sequence, and handling the flow of information between agents.

### 4.2. Specialized Agents
The specialized agents will be located in the `src/agents/` directory.

1.  **Diagnosis Agent:**
    - **Function:** Analyzes patient symptoms and medical history to propose a preliminary diagnosis.
    - **Capabilities:** If the provided information is insufficient, it can formulate questions to gather more data from the patient.

2.  **FHIR Agent:**
    - **Function:** Acts as the sole gateway to the hospital's FHIR server.
    - **Capabilities:** Provides a secure API for other agents to read patient data (e.g., medical history, allergies) and write new information (e.g., diagnoses, test results) back to the patient's record.

3.  **Insurance Agent:**
    - **Function:** Manages insurance-related queries.
    - **Capabilities:** Performs prior-authorization checks for diagnostic tests and procedures to confirm a patient's coverage, preventing delays and financial uncertainty.

4.  **Order Generating Agent:**
    - **Function:** Creates orders for medical procedures, tests, or prescriptions.
    - **Capabilities:** Based on a confirmed diagnosis and insurance approval, it generates the necessary orders in a standardized format.

5.  **Referral Agent:**
    - **Function:** Manages patient referrals to specialists.
    - **Capabilities:** Based on the diagnosis, it identifies the appropriate specialist (e.g., cardiologist, oncologist) and generates a referral request.

## 5. Key Workflows & Data Management

### 5.1. Standard Workflow Example
1.  The **Orchestration Agent** receives a new patient's symptoms.
2.  It tasks the **Diagnosis Agent** to analyze the symptoms.
3.  The **Diagnosis Agent** requests the patient's history from the **FHIR Agent**.
4.  After analysis, the **Diagnosis Agent** returns a potential diagnosis.
5.  The **Orchestration Agent** decides a specific test is needed and tasks the **Insurance Agent** to get prior-authorization.
6.  Once authorized, the **Orchestration Agent** tasks the **Order Generating Agent** to create an order for the test.
7.  All information generated throughout this process is written back to the patient's record via the **FHIR Agent**.

### 5.2. Data Provenance and Auditing
All information generated by any agent must be persisted to the FHIR server as an `Observation` resource. Each `Observation` must contain:
- The identity of the agent that generated the data.
- The content/result produced by the agent.
- A reference to the other data/resources that were used to generate the content, ensuring a fully auditable trail.

## 6. Technical Requirements

- **Programming Language:** Python
- **Project & Dependency Management:** The project will use `uv`.
- **Agent Communication:** Google's A2A (Agent-to-Agent) protocol will be the standard for inter-agent communication.
- **External Integrations:** Agents will use **Model Context Protocol (MCP)** tools to interact with external systems and APIs.
- **FHIR Server:**
    - **Standard:** R4
    - **Endpoint:** `http://192.168.68.211:8080/fhir`
    - **Data Persistence:** The FHIR server is the single source of truth for all patient-related data.

## 7. Assumptions

- The specified FHIR server is accessible from the environment where the agents are running.
- The FHIR server contains dummy patient data for development and testing.
- MCP tools for interacting with the FHIR R4 API will be developed or are already available.
- The Google A2A protocol provides the necessary features for the required inter-agent communication patterns.

## 8. Future Scope

- **Additional Agents:** Introduce new agents for other hospital functions like patient scheduling, billing, and pharmacy management.
- **Advanced Analytics:** Develop a reporting agent that can analyze collective patient data to identify trends and insights for hospital management.
- **EHR Integration:** Expand integration capabilities to support various Electronic Health Record (EHR) systems beyond FHIR.
